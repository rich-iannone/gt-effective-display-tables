# Incorporating Footnotes

```{r setup, include=FALSE, echo=FALSE}
library(gt)
```

## Adding footnotes

*** General introduction to footnotes

### `tab_footnote()` and the `cells_*()` location helpers

The `tab_footnote()` function can make it a painless process to add a footnote to a **gt** table. There are commonly two components to a footnote: (1) a footnote mark that is attached to the targeted cell content, and (2) the footnote text itself that is placed in the table's footer area. Each unit of footnote text in the footer is linked to an element of text or otherwise through the footnote mark. The footnote system in gt presents footnotes in a way that matches the usual expectations, where:

1. footnote marks have a sequence, whether they are symbols, numbers, or letters

2. multiple footnotes can be applied to the same content (and marks are always presented in an ordered fashion)

3. footnote text in the footer is never exactly repeated, gt reuses footnote marks where needed throughout the table

4. footnote marks are ordered across the table in a consistent manner (left to right, top to bottom)

```r
tab_footnote(
  data,
  footnote,
  locations = NULL,
  placement = c("auto", "right", "left")
)
```

<hr>

**`footnote`**: *Footnote text*

`scalar<character>` // **required**

The text to be used in the footnote. We can optionally use the `md()` and `html()` functions to style the text as Markdown or to retain HTML elements in the footnote text.

<hr>

**`locations`**: *Locations to target*

`<locations expressions>` // default: `NULL`, so *optional*

The cell or set of cells to be associated with the footnote. Supplying any of the `cells_*()` helper functions is a useful way to target the location cells that are associated with the footnote text. Additionally, we can enclose several `cells_*()` calls within a `list()` if we wish to link the footnote text to different types of locations (e.g., body cells, row group labels, the table title, etc.).

<hr>

**`placement`**: *Placement of footnote mark*

`singl-kw:[auto|right|left]` // default: `"auto"`

Where to affix footnote marks to the table content. Two options for this are `"left"` or `"right"`, where the placement is either to the absolute left or right of the cell content. By default, however, this option is set to `"auto"` whereby **gt** will choose a preferred left-or-right placement depending on the alignment of the cell content.

<hr>

Using a subset of the `sza` dataset, let's create a new **gt** table. The `sza` column will get all of its cells filled with a background color according to data values (this is done with `data_color()`) and then the use of `tab_footnote()` lets us add a footnote to the `sza` column label (explaining what the color gradient signifies).

```{r}
sza |>
  dplyr::filter(
    latitude == 20 &
      month == "jan" &
      !is.na(sza)
  ) |>
  dplyr::select(-latitude, -month) |>
  gt() |>
  data_color(
    columns = sza,
    palette = c("white", "yellow", "navyblue"),
    domain = c(0, 90)
  ) |>
  tab_footnote(
    footnote = "Color indicates the solar zenith angle.",
    locations = cells_column_labels(columns = sza)
  )
```

Of course, we can add more than one footnote to the table, but, we have to use several calls of `tab_footnote()`. This variation of the `sza` table has three footnotes: one on the `"TST"` column label and two on the `"SZA"` column label (these were capitalized with `opt_all_caps()`). We have three calls of `tab_footnote()` and while the order of calls usually doesn't matter, it does have a subtle effect here since two footnotes are associated with the same text content (try reversing the second and third calls and observe the effect in the footer).

```{r}
sza |>
  dplyr::filter(
    latitude == 20 &
      month == "jan" &
      !is.na(sza)
  ) |>
  dplyr::select(-latitude, -month) |>
  gt() |>
  opt_all_caps() |>
  cols_align(align = "center") |>
  cols_width(everything() ~ px(200)) |>
  tab_footnote(
    footnote = md("TST stands for *True Solar Time*."),
    locations = cells_column_labels(columns = tst)
  ) |>
  tab_footnote(
    footnote = md("SZA stands for *Solar Zenith Angle*."),
    locations = cells_column_labels(columns = sza)
  ) |>
  tab_footnote(
    footnote = "Higher Values indicate sun closer to horizon.",
    locations = cells_column_labels(columns = sza)
  ) |>
  tab_options(footnotes.multiline = FALSE)
```

Text in the footer (both from footnotes and also from source notes) tends to widen the table and all the columns within in. We can limit that setting column widths, which is what was done above with `cols_width()`. There can also be a correspondingly large amount of vertical space taken up by the footer since footnotes will, by default, each start on a new line. In the above example, we used `tab_options(footnotes.multiline = FALSE)` to make it so that all footer text is contained in a single block of text.

Let's move on to another footnote-laden table, this one based on the `towny` dataset. We have a header part, with a title and a subtitle. We can choose which of these could be associated with a footnote and in this case it is the `"subtitle"` (one of two options in the `cells_title()` helper function). This table has a stub with row labels and some of those labels are associated with a footnote. So long as row labels are unique, they can be easily used as row identifiers in `cells_stub()`. The third footnote is placed on the `"Density"` column label. Here, changing the order of the `tab_footnote()` calls has no effect on the final table rendering.

```{r}
towny |>
  dplyr::filter(csd_type == "city") |>
  dplyr::arrange(desc(population_2021)) |>
  dplyr::select(name, density_2021, population_2021) |>
  dplyr::slice_head(n = 10) |>
  gt(rowname_col = "name") |>
  tab_header(
    title = md("The 10 Largest Municipalities in `towny`"),
    subtitle = "Population values taken from the 2021 census."
  ) |>
  fmt_integer() |>
  cols_label(
    density_2021 = "Density",
    population_2021 = "Population"
  ) |>
  tab_footnote(
    footnote = "Part of the Greater Toronto Area.",
    locations = cells_stub(rows = c(
      "Toronto", "Mississauga", "Brampton", "Markham", "Vaughan"
    ))
  ) |>
  tab_footnote(
    footnote = md("Density is in terms of persons per km^2^."),
    locations = cells_column_labels(columns = density_2021)
  ) |>
  tab_footnote(
    footnote = "Census results made public on February 9, 2022.",
    locations = cells_title(groups = "subtitle")
  ) |>
  tab_source_note(source_note = md(
    "Data taken from the `towny` dataset (in the **gt** package)."
  )) |>
  opt_footnote_marks(marks = "letters")
```

In the above table, we elected to change the footnote marks to letters instead of the default numbers (done through `opt_footnote_marks()`). A source note was also added; this was mainly to demonstrate that source notes will be positioned beneath footnotes in the footer section.

For our final example, let's make a relatively small table deriving from the `sp500` dataset. The set of `tab_footnote()` calls used here (four of them) have minor variations that allow for interesting expressions of footnotes. Two of the footnotes target values in the body of the table (using the `cells_body()` helper function to achieve this). On numeric values that right-aligned, **gt** will opt to place the footnote on the left of the content so as to not disrupt the alignment. However, the `placement` argument can be used to force the positioning of the footnote mark after the content.

We can also opt to include footnotes that have no associated footnote marks whatsoever. This is done by not providing anything to `locations`. These 'markless' footnotes will precede the other footnotes in the footer section.

```{r}
sp500 |>
  dplyr::filter(date >= "2015-01-05" & date <="2015-01-10") |>
  dplyr::select(-c(adj_close, volume, high, low)) |>
  dplyr::mutate(change = close - open) |>
  dplyr::arrange(date) |>
  gt() |>
  tab_header(title = "S&P 500") |>
  fmt_date(date_style = "m_day_year") |>
  fmt_currency() |>
  cols_width(everything() ~ px(150)) |>
  tab_footnote(
    footnote = "More red days than green in this period.",
    locations = cells_column_labels(columns = change)
  ) |>
  tab_footnote(
    footnote = "Lowest opening value.",
    locations = cells_body(columns = open, rows = 3),
  ) |>
  tab_footnote(
    footnote = "Devastating losses on this day.",
    locations = cells_body(columns = change, rows = 1),
    placement = "right"
  ) |>
  tab_footnote(footnote = "All values in USD.") |>
  opt_footnote_marks(marks = "LETTERS") |>
  opt_footnote_spec(spec_ref = "i[x]", spec_ftr = "x.")
```

Aside from changing the footnote marks to be `"LETTERS"`, we've also changed the way the marks are formatted. In `opt_footnote_spec()` the `spec_ref` option, governing the footnote marks across the table, describes marks that are italicized and set between square brackets (`"i[x]"`). The `spec_ftr` argument is for the footer representation of the footnote marks and as described in the call with `"x."`, it'll be the mark followed by a period.

### `opt_footnote_*()`


